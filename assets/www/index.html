<html>
<head>
<title>Hey! Sit on it!</title>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<link rel="stylesheet" href="css/styles.css" />
<script src="js/libs/jquery-1.8.2.min.js"></script>
<script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyDXzEqJNIaU_aWf9lDkdzNRCIEOiyyLizs&sensor=false"></script>
<script src="js/data.min.js"></script>
<script src="js/sitonit.js"></script>
<script>
var map;
$(document).ready(function() {
	console.log("DOM ready");
    map = new sitonit.map();

    map.initMap($("#map_canvas").get(0));
    
    console.info("map:",map);

    google.maps.event.addListener(map.map, 'dragend', function(event) {
    	// redo search within bounds
    });
 
	var gotClosest = function(center, closest) {
		map.clearMarkers();
		$(closest).each(function(i, pop) {
			var marker = map.addPop(pop);
		});	
		map.showCentroid(center);
		map.setBoundsByMarkers();
	};

	function clicked(e) {
		console.log("Mapping result");
		$("#didjamean").empty();
		var address = $("input[name=address]").attr("value")
		if (address != '') {
			address += " New York, NY";
		}
		console.log("Finding address " + address);
		var center = map.findByAddress(address, gotClosest, addSuggestions);
		map.showCentroid(center);

		return false;
	}
	
	function addSuggestions(results) {
		for (var i = 0; i < results.length; i++) {
			$("#didjamean").append($("<li>Or did you mean <a href=\"" + results[i].formatted_address + "\">" + results[i].formatted_address + "</a></li>"));
		}
		$("#didjamean li a").click(function() {
			console.info("pick address", this);
			$("#didjamean").empty();
			var center = map.findByAddress(this.innerText, gotClosest, addSuggestions);
			map.showCentroid(center);
			return false;
		});
	}
	
	$("#mapit").bind("touchstart", clicked);
	$("#mapit").click(clicked);
});	
</script>
</head>
<body>
<form id="finder">
<label for="address">Enter address:</label>
<input type="text" name="address" placeholder="Street address or blank for current location" size="50" maxlength="1024" />
<input type="submit" id="mapit" value="Find a seat" />

</form>
<ul id="didjamean"></ul>
<div id="map_canvas"></div>
<div class="info-window">
	<div><img src="img/poplogo_icon.png" /></div>
	<div class="name">Place name</div>
	<div class="address"></div>
	<div class="description"></div>
</div>
</body>
</html>